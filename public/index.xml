<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mateusz Karwat </title>
    <link>http://mateuszkarwat.com/index.xml</link>
    <language>en-us</language>
    <author></author>
    <rights>(C) 2017</rights>
    <updated>2017-02-15 00:00:00 &#43;0000 UTC</updated>

    
      
        <item>
          <title>Return keyword and following expression</title>
          <link>http://mateuszkarwat.com/post/return-keyword/</link>
          <pubDate>Wed, 15 Feb 2017 00:00:00 UTC</pubDate>
          <author></author>
          <guid>http://mateuszkarwat.com/post/return-keyword/</guid>
          <description>&lt;p&gt;Lately I was left with question which made me a bit like &amp;ldquo;whaaaaaat?&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;A friend of mine told me that some time ago while he was debugging something, he used a &lt;code&gt;return&lt;/code&gt; keyword in the middle of a function, because he wanted to check what happens when that function ends its execution earlier. He was really surprised when it turned out that a function following &lt;code&gt;return&lt;/code&gt; statement had been called anyway.&lt;/p&gt;

&lt;p&gt;To simplify our problem let&amp;rsquo;s make a very easy example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;func returnInTheMiddle() {
  print(&amp;quot;This is called as expected&amp;quot;)
  return
  print(&amp;quot;This is called as well&amp;quot;)
}

returnInTheMiddle()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When you run that piece of code, you&amp;rsquo;ll see that &lt;strong&gt;second &lt;code&gt;print&lt;/code&gt; statement will be called. Why is that?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Fortunately Xcode doesn&amp;rsquo;t leave us without a warning here. It displays the following message:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Expression following &amp;lsquo;return&amp;rsquo; is treated as an argument of a &amp;lsquo;return&amp;rsquo;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;That pretty much is an answers to our question. When &lt;code&gt;return&lt;/code&gt; is being called it sometimes takes an expression, which in this case is a function. Passed function is called before its return value is passed to the &lt;code&gt;return&lt;/code&gt; statement. That&amp;rsquo;s why second &lt;code&gt;print&lt;/code&gt; statement is called.&lt;/p&gt;

&lt;p&gt;Despite how good that answer is, I wanted to know how actually &lt;code&gt;return&lt;/code&gt; keyword is implemented. What kind of expression it actually is.&lt;/p&gt;

&lt;p&gt;In &lt;a href=&#34;https://developer.apple.com/library/prerelease/content/documentation/Swift/Conceptual/Swift_Programming_Language/Statements.html#//apple_ref/doc/uid/TP40014097-CH33-ID428&#34;&gt;Statements&lt;/a&gt; chapter of &lt;a href=&#34;https://developer.apple.com/library/prerelease/content/documentation/Swift/Conceptual/Swift_Programming_Language/AboutTheLanguageReference.html#//apple_ref/doc/uid/TP40014097-CH29-ID345&#34;&gt;Language Reference&lt;/a&gt; we can find a description of a &lt;code&gt;return&lt;/code&gt; keyword, which also contains information about any following expression:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;When a return statement is followed by an expression, the value of the expression is returned to the calling function or method. If the value of the expression does not match the value of the return type declared in the function or method declaration, the expression’s value is converted to the return type before it is returned to the calling function or method.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;With that information in hand I tried to find an actual implementation of it and I did find what I was looking for. Parsing &lt;code&gt;return&lt;/code&gt; statement is located in &lt;a href=&#34;https://github.com/apple/swift/blob/cb3bdcc2a36699abf1b7d5b0a791b9011959ac4a/lib/Parse/ParseStmt.cpp&#34;&gt;ParseStmt.cpp&lt;/a&gt; file and function which does that is called &lt;code&gt;ParserResult&amp;lt;Stmt&amp;gt; Parser::parseStmtReturn(SourceLoc tryLoc)&lt;/code&gt;. There is one particular comment which is interesting:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Handle the ambiguity between consuming the expression and allowing the enclosing stmt-brace to get it by eagerly eating it unless the return is followed by a &amp;lsquo;}&amp;rsquo;, &amp;lsquo;;&amp;rsquo;, statement or decl start keyword sequence.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Now we can be really sure, that if &lt;code&gt;return&lt;/code&gt; statement is followed by an expression which returns the same type as a type of calling function, it will be called and treated as an argument of &lt;code&gt;return&lt;/code&gt; statement.&lt;/p&gt;

&lt;p&gt;To avoid this kind of behaviour, if you really need to put &lt;code&gt;return&lt;/code&gt; statement in the middle of a function, make sure it&amp;rsquo;s either followed by &lt;code&gt;}&lt;/code&gt; (which is very common scenario and used everywhere) or &lt;code&gt;;&lt;/code&gt; character. &lt;code&gt;;&lt;/code&gt; character following &lt;code&gt;return&lt;/code&gt; keyword is not a very good idea. Using that, you probably have some code which has no chance to be called. Anyway, for debugging purposes our example could look like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;func returnInTheMiddle() {
  print(&amp;quot;This is called as expected&amp;quot;)
  return;
  print(&amp;quot;This is called as well&amp;quot;)
}

returnInTheMiddle()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This time, second &lt;code&gt;print&lt;/code&gt; statement is not called and never will be.&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Nested Protocols</title>
          <link>http://mateuszkarwat.com/post/nested-protocols/</link>
          <pubDate>Sat, 26 Nov 2016 00:00:00 UTC</pubDate>
          <author></author>
          <guid>http://mateuszkarwat.com/post/nested-protocols/</guid>
          <description>&lt;p&gt;Yesterday my friend who has been transfered from iOS team to Android team
showed me something he thinks is really cool in Java and he would love to see in Swift. He showed me that there is a possibility to put an interface declaration inside a class. In Swift it means - put a protocol definition inside a struct, class or enum definition.&lt;/p&gt;

&lt;p&gt;Unfortunately, according to the &lt;a href=&#34;https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/NestedTypes.html&#34;&gt;Swift documentation&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Swift enables you to define nested types, whereby you nest supporting enumerations, classes, and structures within the definition of the type they support.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It means that currently in Swift there is no way to define a nested protocol. In other words - protocols are valid at file scope only.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;But why would it be nice to have anyway?&lt;/em&gt; - you may ask. Imagine you could write a code like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;// Please remember that this code won&#39;t compile.

class FileInformationProvider {
  protocol Delegate: class { }

  weak var delegate: Delegate?
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If you would like to create a class which conforms to that protocol, you would write:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class FileManager: FileInformationProvider.Delegate { }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I&amp;rsquo;m sure you can see an advantage of this approach. There is no need to create a protocol called &lt;code&gt;FileInformationProviderDelegate&lt;/code&gt; which is declared out of &lt;code&gt;FileInformationProvider&lt;/code&gt; namespace. Having a nested protocol limits it inside a type to which it refers directly to. It gives more clarity to our code without a need of wondering which specific class uses this delegate protocol.&lt;/p&gt;

&lt;p&gt;In Swift it&amp;rsquo;s very common practice to create a nested &lt;code&gt;struct&lt;/code&gt; or &lt;code&gt;enum&lt;/code&gt; to store all constants, states or keys used within a specific scope. For example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class InformationFetcher {
  struct Constants {
    static let baseURL = &amp;quot;http://mateuszkarwat.com&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So how can we achieve the same namespacing with protocols? I came up with one solution. It involves a &lt;code&gt;typealias&lt;/code&gt; keyword. The &lt;code&gt;typealias&lt;/code&gt; keyword introduces a named alias of an existing type into your program&lt;sup&gt;&lt;a href=&#34;#fn1&#34; id=&#34;ref1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;. Here is what we can do:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;protocol FileInformationProviderDelegate { }

class FileInformationProvider {
  typealias Delegate = FileInformationProviderDelegate

  weak var delegate: Delegate?
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Our code compiles now and we can conform to nested protocol by calling &lt;code&gt;FileInformationProvider.Delegate&lt;/code&gt; just as we wanted. It doesn&amp;rsquo;t hide &lt;code&gt;FileInformationProviderDelegate&lt;/code&gt; declaration though, so the protocol is still accessible outside &lt;code&gt;FileInformationProvider&lt;/code&gt; namespace. However, with this approach we can go further and for example create nested protocols like &lt;code&gt;.DataSource&lt;/code&gt; in our table view controllers.&lt;/p&gt;

&lt;p&gt;Is this any better than just:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class FileInformationProvider {
  weak var delegate: FileInformationProviderDelegate?
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I don&amp;rsquo;t know. I guess it&amp;rsquo;s totally up to you. You might say that this solution requires a bit more code to write and probably looks like some kind of a workaround. It&amp;rsquo;s absolutely true. I&amp;rsquo;m not a big fan of it either and I probably won&amp;rsquo;t use it. The goal here was to show you there is a way to create a &amp;ldquo;nestedish&amp;rdquo; protocol in Swift in case you desperately need it.&lt;/p&gt;

&lt;p&gt;If you come up with better solution, please let me know. I would love to try it out.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;sup id=&#34;fn1&#34;&gt;1. &lt;a href=&#34;https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Declarations.html#//apple_ref/doc/uid/TP40014097-CH34-ID361&#34;&gt;The Swift Programming Language - Type Alias Declaration&lt;/a&gt;&lt;a href=&#34;#ref1&#34; title=&#34;Jump back to footnote 1 in the text.&#34;&gt;↩&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
</description>
        </item>
      
    
      
    
      
    
      
    

  </channel>
</rss>